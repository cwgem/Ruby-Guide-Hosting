<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Open3
  
    &mdash; Ruby 1.9 Ruby Standard Library
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (O)</a> &raquo; 
    
    
    <span class="title">Open3</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Open3
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/open3.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Open3 grants you access to stdin, stdout, stderr and a thread to wait the
child process when running another program. You can specify various
attributes, redirections, current directory, etc., of the program as
Process.spawn.</p>
<ul><li>
<p>Open3.popen3 : pipes for stdin, stdout, stderr</p>
</li><li>
<p>Open3.popen2 : pipes for stdin, stdout</p>
</li><li>
<p>Open3.popen2e : pipes for stdin, merged stdout and stderr</p>
</li><li>
<p>Open3.capture3 : give a string for stdin.  get strings for stdout, stderr</p>
</li><li>
<p>Open3.capture2 : give a string for stdin.  get a string for stdout</p>
</li><li>
<p>Open3.capture2e : give a string for stdin.  get a string for merged stdout
and stderr</p>
</li><li>
<p>Open3.pipeline_rw : pipes for first stdin and last stdout of a pipeline</p>
</li><li>
<p>Open3.pipeline_r : pipe for last stdout of a pipeline</p>
</li><li>
<p>Open3.pipeline_w : pipe for first stdin of a pipeline</p>
</li><li>
<p>Open3.pipeline_start : a pipeline</p>
</li><li>
<p>Open3.pipeline : run a pipline and wait</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
</div>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture2-instance_method" title="#capture2 (instance method)">- (Object) <strong>capture2</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture2 captures the standard output of a command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture2e-instance_method" title="#capture2e (instance method)">- (Object) <strong>capture2e</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture2e captures the standard output and the standard error of a
command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture3-instance_method" title="#capture3 (instance method)">- (Object) <strong>capture3</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.capture3 captures the standard output and the standard error of a
command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline-instance_method" title="#pipeline (instance method)">- (Object) <strong>pipeline</strong>(*cmds) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline starts a list of commands as a pipeline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_r-instance_method" title="#pipeline_r (instance method)">- (Object) <strong>pipeline_r</strong>(*cmds, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_r starts a list of commands as a pipeline with a pipe which
connects stdout of the last command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_run-instance_method" title="#pipeline_run (instance method)">- (Object) <strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_rw-instance_method" title="#pipeline_rw (instance method)">- (Object) <strong>pipeline_rw</strong>(*cmds, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_rw starts a list of commands as a pipeline with pipes which
connects stdin of the first command and stdout of the last command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_start-instance_method" title="#pipeline_start (instance method)">- (Object) <strong>pipeline_start</strong>(*cmds, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_start starts a list of commands as a pipeline.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pipeline_w-instance_method" title="#pipeline_w (instance method)">- (Object) <strong>pipeline_w</strong>(*cmds, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.pipeline_w starts a list of commands as a pipeline with a pipe which
connects stdin of the first command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen2-instance_method" title="#popen2 (instance method)">- (Object) <strong>popen2</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.popen2 is similer to Open3.popen3 except it doesn't make a pipe for
the standard error stream.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen2e-instance_method" title="#popen2e (instance method)">- (Object) <strong>popen2e</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open3.popen2e is similer to Open3.popen3 except it merges the standard
output stream and the standard error stream.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen3-instance_method" title="#popen3 (instance method)">- (Object) <strong>popen3</strong>(*cmd, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Open stdin, stdout, and stderr streams and start external executable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#popen_run-instance_method" title="#popen_run (instance method)">- (Object) <strong>popen_run</strong>(cmd, opts, child_io, parent_io) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>:nodoc:.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="capture2-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>capture2</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture2 captures the standard output of a command.</p>

<pre class="code">stdout_str, status = Open3.capture2([env,] cmd... [, opts])</pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
opts[:stdin_data] and opts[:binmode].  See Process.spawn.</p>

<p>If opts[:stdin_data] is specified, it is sent to the command's standard
input.</p>

<p>If opts[:binmode] is true, internal pipes are set to binary mode.</p>

<p>Example:</p>

<pre class="code"><span class='comment'># factor is a command for integer factorization.
</span><span class='id o'>o</span><span class='comma'>,</span> <span class='id s'>s</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture2'>capture2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>factor</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>42</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id p'>p</span> <span class='id o'>o</span> <span class='comment'>#=&gt; &quot;42: 2 3 7\n&quot;
</span>
<span class='comment'># generate x**2 graph in png using gnuplot.
</span><span class='id gnuplot_commands'>gnuplot_commands</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;&quot;End&quot;</span>
<span class='tstring_content'>  set terminal png
  plot x**2, &quot;-&quot; with lines
  1 14
  2 1
  3 8
  4 5
  e
</span><span class='heredoc_end'>End
</span><span class='id image'>image</span><span class='comma'>,</span> <span class='id s'>s</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture2'>capture2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gnuplot</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id gnuplot_commands'>gnuplot_commands</span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 314</span>

<span class='kw'>def</span> <span class='id capture2'>capture2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:stdin_data</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id binmode'>binmode</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:binmode</span><span class='rparen'>)</span>

  <span class='id popen2'>popen2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span> <span class='id o'>o</span><span class='comma'>,</span> <span class='id t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id binmode'>binmode</span>
      <span class='id i'>i</span><span class='period'>.</span><span class='id binmode'>binmode</span>
      <span class='id o'>o</span><span class='period'>.</span><span class='id binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='id o'>o</span><span class='period'>.</span><span class='id read'>read</span> <span class='rbrace'>}</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id write'>write</span> <span class='id stdin_data'>stdin_data</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
    <span class='lbracket'>[</span><span class='id out_reader'>out_reader</span><span class='period'>.</span><span class='id value'>value</span><span class='comma'>,</span> <span class='id t'>t</span><span class='period'>.</span><span class='id value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="capture2e-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>capture2e</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture2e captures the standard output and the standard error of a
command.</p>

<pre class="code">stdout_and_stderr_str, status = Open3.capture2e([env,] cmd... [, opts])</pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
opts[:stdin_data] and opts[:binmode].  See Process.spawn.</p>

<p>If opts[:stdin_data] is specified, it is sent to the command's standard
input.</p>

<p>If opts[:binmode] is true, internal pipes are set to binary mode.</p>

<p>Example:</p>

<pre class="code"><span class='comment'># capture make log
</span><span class='id make_log'>make_log</span><span class='comma'>,</span> <span class='id s'>s</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture2e'>capture2e</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>make</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 353</span>

<span class='kw'>def</span> <span class='id capture2e'>capture2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:stdin_data</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id binmode'>binmode</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:binmode</span><span class='rparen'>)</span>

  <span class='id popen2e'>popen2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span> <span class='id oe'>oe</span><span class='comma'>,</span> <span class='id t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id binmode'>binmode</span>
      <span class='id i'>i</span><span class='period'>.</span><span class='id binmode'>binmode</span>
      <span class='id oe'>oe</span><span class='period'>.</span><span class='id binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id outerr_reader'>outerr_reader</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='id oe'>oe</span><span class='period'>.</span><span class='id read'>read</span> <span class='rbrace'>}</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id write'>write</span> <span class='id stdin_data'>stdin_data</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
    <span class='lbracket'>[</span><span class='id outerr_reader'>outerr_reader</span><span class='period'>.</span><span class='id value'>value</span><span class='comma'>,</span> <span class='id t'>t</span><span class='period'>.</span><span class='id value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="capture3-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>capture3</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.capture3 captures the standard output and the standard error of a
command.</p>

<pre class="code">stdout_str, stderr_str, status = Open3.capture3([env,] cmd... [, opts])</pre>

<p>The arguments env, cmd and opts are passed to Open3.popen3 except
opts[:stdin_data] and opts[:binmode].  See Process.spawn.</p>

<p>If opts[:stdin_data] is specified, it is sent to the command's standard
input.</p>

<p>If opts[:binmode] is true, internal pipes are set to binary mode.</p>

<p>Example:</p>

<pre class="code"><span class='comment'># dot is a command of graphviz.
</span><span class='id graph'>graph</span> <span class='op'>=</span> <span class='heredoc_beg'>&lt;&lt;'End'</span>
<span class='tstring_content'>  digraph g {
    a -&gt; b
  }
</span><span class='heredoc_end'>End
</span><span class='id layouted_graph'>layouted_graph</span><span class='comma'>,</span> <span class='id dot_log'>dot_log</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dot -v</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id graph'>graph</span><span class='rparen'>)</span>

<span class='id o'>o</span><span class='comma'>,</span> <span class='id e'>e</span><span class='comma'>,</span> <span class='id s'>s</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>echo a; sort &gt;&amp;2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo\nbar\nbaz\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id p'>p</span> <span class='id o'>o</span> <span class='comment'>#=&gt; &quot;a\n&quot;
</span><span class='id p'>p</span> <span class='id e'>e</span> <span class='comment'>#=&gt; &quot;bar\nbaz\nfoo\n&quot;
</span><span class='id p'>p</span> <span class='id s'>s</span> <span class='comment'>#=&gt; #&lt;Process::Status: pid 32682 exit 0&gt;
</span>
<span class='comment'># generate a thumnail image using the convert command of ImageMagick.
</span><span class='comment'># However, if the image stored really in a file,
</span><span class='comment'># system(&quot;convert&quot;, &quot;-thumbnail&quot;, &quot;80&quot;, &quot;png:#{filename}&quot;, &quot;png:-&quot;) is better
</span><span class='comment'># because memory consumption.
</span><span class='comment'># But if the image is stored in a DB or generated by gnuplot Open3.capture2 example,
</span><span class='comment'># Open3.capture3 is considerable.
</span><span class='comment'>#
</span><span class='id image'>image</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/openclipart/png/animals/mammals/sheep-md-v0.1.png</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='id thumnail'>thumnail</span><span class='comma'>,</span> <span class='id err'>err</span><span class='comma'>,</span> <span class='id s'>s</span> <span class='op'>=</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id capture3'>capture3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>convert -thumbnail 80 png:- png:-</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:stdin_data</span><span class='op'>=&gt;</span><span class='id image'>image</span><span class='comma'>,</span> <span class='symbol'>:binmode</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id s'>s</span><span class='period'>.</span><span class='id success?'>success?</span>
  <span class='const'>STDOUT</span><span class='period'>.</span><span class='id binmode'>binmode</span><span class='semicolon'>;</span> <span class='id print'>print</span> <span class='id thumnail'>thumnail</span>
<span class='kw'>end</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 260</span>

<span class='kw'>def</span> <span class='id capture3'>capture3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id stdin_data'>stdin_data</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:stdin_data</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id binmode'>binmode</span> <span class='op'>=</span> <span class='id opts'>opts</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:binmode</span><span class='rparen'>)</span>

  <span class='id popen3'>popen3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span> <span class='id o'>o</span><span class='comma'>,</span> <span class='id e'>e</span><span class='comma'>,</span> <span class='id t'>t</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id binmode'>binmode</span>
      <span class='id i'>i</span><span class='period'>.</span><span class='id binmode'>binmode</span>
      <span class='id o'>o</span><span class='period'>.</span><span class='id binmode'>binmode</span>
      <span class='id e'>e</span><span class='period'>.</span><span class='id binmode'>binmode</span>
    <span class='kw'>end</span>
    <span class='id out_reader'>out_reader</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='id o'>o</span><span class='period'>.</span><span class='id read'>read</span> <span class='rbrace'>}</span>
    <span class='id err_reader'>err_reader</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id new'>new</span> <span class='lbrace'>{</span> <span class='id e'>e</span><span class='period'>.</span><span class='id read'>read</span> <span class='rbrace'>}</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id write'>write</span> <span class='id stdin_data'>stdin_data</span>
    <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
    <span class='lbracket'>[</span><span class='id out_reader'>out_reader</span><span class='period'>.</span><span class='id value'>value</span><span class='comma'>,</span> <span class='id err_reader'>err_reader</span><span class='period'>.</span><span class='id value'>value</span><span class='comma'>,</span> <span class='id t'>t</span><span class='period'>.</span><span class='id value'>value</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline</strong>(*cmds) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline starts a list of commands as a pipeline. It waits the finish
of the commands. No pipe made for stdin of the first command and stdout of
the last command.</p>

<pre class="code">status_list = Open3.pipeline(cmd1, cmd2, ... [, opts])</pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</pre>

<p>Example:</p>

<pre class="code"><span class='id fname'>fname</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/man/man1/ruby.1.gz</span><span class='tstring_end'>&quot;</span></span>
<span class='id p'>p</span> <span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>zcat</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id fname'>fname</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nroff -man</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>less</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [#&lt;Process::Status: pid 11817 exit 0&gt;,
</span><span class='comment'>#    #&lt;Process::Status: pid 11820 exit 0&gt;,
</span><span class='comment'>#    #&lt;Process::Status: pid 11828 exit 0&gt;]
</span>
<span class='id fname'>fname</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/usr/share/man/man1/ls.1.gz</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>zcat</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id fname'>fname</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nroff -man</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>colcrt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># convert PDF to PS and send to a printer by lpr
</span><span class='id pdf_file'>pdf_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paper.pdf</span><span class='tstring_end'>&quot;</span></span>
<span class='id printer'>printer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>printer-name</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pdftops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id pdf_file'>pdf_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
               <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lpr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-P</span><span class='embexpr_beg'>#{</span><span class='id printer'>printer</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>

<span class='comment'># count lines
</span><span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>uniq -c</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>names.txt</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='comment'># cyclic pipeline
</span><span class='id r'>r</span><span class='comma'>,</span><span class='id w'>w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
<span class='id w'>w</span><span class='period'>.</span><span class='id print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ibase=14\n10\n</span><span class='tstring_end'>&quot;</span></span>
<span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tee /dev/tty</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:in</span><span class='op'>=&gt;</span><span class='id r'>r</span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='id w'>w</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; 14
</span><span class='comment'>#   18
</span><span class='comment'>#   22
</span><span class='comment'>#   30
</span><span class='comment'>#   42
</span><span class='comment'>#   58
</span><span class='comment'>#   78
</span><span class='comment'>#   106
</span><span class='comment'>#   202</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


643
644
645
646
647
648
649
650
651
652
653</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 643</span>

<span class='kw'>def</span> <span class='id pipeline'>pipeline</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmds'>cmds</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id ts'>ts</span><span class='op'>|</span>
    <span class='id ts'>ts</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id t'>t</span><span class='op'>|</span> <span class='id t'>t</span><span class='period'>.</span><span class='id value'>value</span> <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline_r-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline_r</strong>(*cmds, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_r starts a list of commands as a pipeline with a pipe which
connects stdout of the last command.</p>

<pre class="code">Open3.pipeline_r(cmd1, cmd2, ... [, opts]) {|last_stdout, wait_threads|
  ...
}

last_stdout, wait_threads = Open3.pipeline_r(cmd1, cmd2, ... [, opts])
...
last_stdout.close</pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</pre>

<p>Example:</p>

<pre class="code">Open3.pipeline_r(&quot;zcat /var/log/apache2/access.log.*.gz&quot;,
                 [{&quot;LANG&quot;=&gt;&quot;C&quot;}, &quot;grep&quot;, &quot;GET /favicon.ico&quot;],
                 &quot;logresolve&quot;) {|o, ts|
  o.each_line {|line|
    ...
  }
}

Open3.pipeline_r(&quot;yes&quot;, &quot;head -10&quot;) {|o, ts|
  p o.read      #=&gt; &quot;y\ny\ny\ny\ny\ny\ny\ny\ny\ny\n&quot;
  p ts[0].value #=&gt; #&lt;Process::Status: pid 24910 SIGPIPE (signal 13)&gt;
  p ts[1].value #=&gt; #&lt;Process::Status: pid 24913 exit 0&gt;
}</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


474
475
476
477
478
479
480
481
482
483
484
485</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 474</span>

<span class='kw'>def</span> <span class='id pipeline_r'>pipeline_r</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id out_w'>out_w</span>

  <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline_run-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline_run</strong>(cmds, pipeline_opts, child_io, parent_io, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 656</span>

<span class='kw'>def</span> <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='comma'>,</span> <span class='id child_io'>child_io</span><span class='comma'>,</span> <span class='id parent_io'>parent_io</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='kw'>if</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no commands</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id opts_base'>opts_base</span> <span class='op'>=</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='id opts_base'>opts_base</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='symbol'>:in</span>
  <span class='id opts_base'>opts_base</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='symbol'>:out</span>

  <span class='id wait_thrs'>wait_thrs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id r'>r</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id each_with_index'>each_with_index</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id i'>i</span><span class='op'>|</span>
    <span class='id cmd_opts'>cmd_opts</span> <span class='op'>=</span> <span class='id opts_base'>opts_base</span><span class='period'>.</span><span class='id dup'>dup</span>
    <span class='kw'>if</span> <span class='const'>String</span> <span class='op'>===</span> <span class='id cmd'>cmd</span>
      <span class='id cmd'>cmd</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id cmd'>cmd</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id update'>update</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id i'>i</span> <span class='op'>==</span> <span class='int'>0</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:in</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:in</span><span class='rparen'>)</span>
          <span class='id cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id r'>r</span>
    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id i'>i</span> <span class='op'>!=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id length'>length</span> <span class='op'>-</span> <span class='int'>1</span>
      <span class='id r2'>r2</span><span class='comma'>,</span> <span class='id w2'>w2</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
      <span class='id cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id w2'>w2</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='op'>!</span><span class='id cmd_opts'>cmd_opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:out</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='symbol'>:out</span><span class='rparen'>)</span>
          <span class='id cmd_opts'>cmd_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id pipeline_opts'>pipeline_opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id pid'>pid</span> <span class='op'>=</span> <span class='id spawn'>spawn</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id cmd_opts'>cmd_opts</span><span class='rparen'>)</span>
    <span class='id wait_thrs'>wait_thrs</span> <span class='op'>&lt;&lt;</span> <span class='const'>Process</span><span class='period'>.</span><span class='id detach'>detach</span><span class='lparen'>(</span><span class='id pid'>pid</span><span class='rparen'>)</span>
    <span class='id r'>r</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>if</span> <span class='id r'>r</span>
    <span class='id w2'>w2</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>if</span> <span class='id w2'>w2</span>
    <span class='id r'>r</span> <span class='op'>=</span> <span class='id r2'>r2</span>
  <span class='rbrace'>}</span>
  <span class='id result'>result</span> <span class='op'>=</span> <span class='id parent_io'>parent_io</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='id wait_thrs'>wait_thrs</span><span class='rbracket'>]</span>
  <span class='id child_io'>child_io</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id close'>close</span> <span class='rbrace'>}</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='op'>*</span><span class='id result'>result</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id parent_io'>parent_io</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>unless</span> <span class='id io'>io</span><span class='period'>.</span><span class='id closed?'>closed?</span><span class='rbrace'>}</span>
      <span class='id wait_thrs'>wait_thrs</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id t'>t</span><span class='op'>|</span> <span class='id t'>t</span><span class='period'>.</span><span class='id join'>join</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline_rw-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline_rw</strong>(*cmds, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_rw starts a list of commands as a pipeline with pipes which
connects stdin of the first command and stdout of the last command.</p>

<pre class="code">Open3.pipeline_rw(cmd1, cmd2, ... [, opts]) {|first_stdin, last_stdout, wait_threads|
  ...
}

first_stdin, last_stdout, wait_threads = Open3.pipeline_rw(cmd1, cmd2, ... [, opts])
...
first_stdin.close
last_stdout.close</pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</pre>

<p>The option to pass Process.spawn is constructed by merging <tt>opts</tt>,
the last hash element of the array and specification for the pipe between
each commands.</p>

<p>Example:</p>

<pre class="code"><span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tr -dc A-Za-z</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wc -c</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span><span class='id o'>o</span><span class='comma'>,</span><span class='id ts'>ts</span><span class='op'>|</span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>All persons more than a mile high to leave the court.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='id p'>p</span> <span class='id o'>o</span><span class='period'>.</span><span class='id gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sort</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cat -n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id stdin'>stdin</span><span class='comma'>,</span> <span class='id stdout'>stdout</span><span class='comma'>,</span> <span class='id wait_thrs'>wait_thrs</span><span class='op'>|</span>
  <span class='id stdin'>stdin</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span>
  <span class='id stdin'>stdin</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='id stdin'>stdin</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span>
  <span class='id stdin'>stdin</span><span class='period'>.</span><span class='id close'>close</span>     <span class='comment'># send EOF to sort.
</span>  <span class='id p'>p</span> <span class='id stdout'>stdout</span><span class='period'>.</span><span class='id read'>read</span>   <span class='comment'>#=&gt; &quot;     1\tbar\n     2\tbaz\n     3\tfoo\n&quot;
</span><span class='rbrace'>}</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 418</span>

<span class='kw'>def</span> <span class='id pipeline_rw'>pipeline_rw</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id in_r'>in_r</span>
  <span class='id in_w'>in_w</span><span class='period'>.</span><span class='id sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id out_w'>out_w</span>

  <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_w'>in_w</span><span class='comma'>,</span> <span class='id out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline_start-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline_start</strong>(*cmds, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_start starts a list of commands as a pipeline. No pipe made
for stdin of the first command and stdout of the last command.</p>

<pre class="code">Open3.pipeline_start(cmd1, cmd2, ... [, opts]) {|wait_threads|
  ...
}

wait_threads = Open3.pipeline_start(cmd1, cmd2, ... [, opts])
...</pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</pre>

<p>Example:</p>

<pre class="code"><span class='comment'># run xeyes in 10 seconds.
</span><span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>xeyes</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id ts'>ts</span><span class='op'>|</span>
  <span class='id sleep'>sleep</span> <span class='int'>10</span>
  <span class='id t'>t</span> <span class='op'>=</span> <span class='id ts'>ts</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='const'>Process</span><span class='period'>.</span><span class='id kill'>kill</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TERM</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id t'>t</span><span class='period'>.</span><span class='id pid'>pid</span><span class='rparen'>)</span>
  <span class='id p'>p</span> <span class='id t'>t</span><span class='period'>.</span><span class='id value'>value</span> <span class='comment'>#=&gt; #&lt;Process::Status: pid 911 SIGTERM (signal 15)&gt;
</span><span class='rbrace'>}</span>

<span class='comment'># convert pdf to ps and send it to a printer.
</span><span class='comment'># collect error message of pdftops and lpr.
</span><span class='id pdf_file'>pdf_file</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>paper.pdf</span><span class='tstring_end'>&quot;</span></span>
<span class='id printer'>printer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>printer-name</span><span class='tstring_end'>&quot;</span></span>
<span class='id err_r'>err_r</span><span class='comma'>,</span> <span class='id err_w'>err_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
<span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pdftops</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id pdf_file'>pdf_file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>lpr</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-P</span><span class='embexpr_beg'>#{</span><span class='id printer'>printer</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
                     <span class='symbol'>:err</span><span class='op'>=&gt;</span><span class='id err_w'>err_w</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id ts'>ts</span><span class='op'>|</span>
  <span class='id err_w'>err_w</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='id p'>p</span> <span class='id err_r'>err_r</span><span class='period'>.</span><span class='id read'>read</span> <span class='comment'># error messages of pdftops and lpr.
</span><span class='rbrace'>}</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


575
576
577
578
579
580
581
582
583
584
585
586
587
588</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 575</span>

<span class='kw'>def</span> <span class='id pipeline_start'>pipeline_start</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id block'>block</span>
    <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id ts'>ts</span><span class='comma'>,</span> <span class='op'>=</span> <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id ts'>ts</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="pipeline_w-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>pipeline_w</strong>(*cmds, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.pipeline_w starts a list of commands as a pipeline with a pipe which
connects stdin of the first command.</p>

<pre class="code">Open3.pipeline_w(cmd1, cmd2, ... [, opts]) {|first_stdin, wait_threads|
  ...
}

first_stdin, wait_threads = Open3.pipeline_w(cmd1, cmd2, ... [, opts])
...
first_stdin.close</pre>

<p>Each cmd is a string or an array. If it is an array, the elements are
passed to Process.spawn.</p>

<pre class="code">cmd:
  commandline                              command line string which is passed to a shell
  [env, commandline, opts]                 command line string which is passed to a shell
  [env, cmdname, arg1, ..., opts]          command name and one or more arguments (no shell)
  [env, [cmdname, argv0], arg1, ..., opts] command name and arguments including argv[0] (no shell)

Note that env and opts are optional, as Process.spawn.</pre>

<p>Example:</p>

<pre class="code"><span class='const'>Open3</span><span class='period'>.</span><span class='id pipeline_w'>pipeline_w</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bzip2 -c</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:out</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/hello.bz2</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span> <span class='id ts'>ts</span><span class='op'>|</span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello</span><span class='tstring_end'>&quot;</span></span>
<span class='rbrace'>}</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


516
517
518
519
520
521
522
523
524
525
526
527
528</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 516</span>

<span class='kw'>def</span> <span class='id pipeline_w'>pipeline_w</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmds'>cmds</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id in_r'>in_r</span>
  <span class='id in_w'>in_w</span><span class='period'>.</span><span class='id sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id pipeline_run'>pipeline_run</span><span class='lparen'>(</span><span class='id cmds'>cmds</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_r'>in_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_w'>in_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="popen2-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>popen2</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.popen2 is similer to Open3.popen3 except it doesn't make a pipe for
the standard error stream.</p>

<p>Block form:</p>

<pre class="code">Open3.popen2([env,] cmd... [, opts]) {|stdin, stdout, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</pre>

<p>Non-block form:</p>

<pre class="code">stdin, stdout, wait_thr = Open3.popen2([env,] cmd... [, opts])
...
stdin.close  # stdin and stdout should be closed explicitly in this form.
stdout.close</pre>

<p>See Process.spawn for the optional hash arguments <em>env</em> and
<em>opts</em>.</p>

<p>Example:</p>

<pre class="code"><span class='const'>Open3</span><span class='period'>.</span><span class='id popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>wc -c</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span><span class='id o'>o</span><span class='comma'>,</span><span class='id t'>t</span><span class='op'>|</span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>answer to life the universe and everything</span><span class='tstring_end'>&quot;</span></span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='id p'>p</span> <span class='id o'>o</span><span class='period'>.</span><span class='id gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'>Open3</span><span class='period'>.</span><span class='id popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bc -q</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span><span class='id o'>o</span><span class='comma'>,</span><span class='id t'>t</span><span class='op'>|</span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>obase=13</span><span class='tstring_end'>&quot;</span></span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>6 * 9</span><span class='tstring_end'>&quot;</span></span>
  <span class='id p'>p</span> <span class='id o'>o</span><span class='period'>.</span><span class='id gets'>gets</span> <span class='comment'>#=&gt; &quot;42\n&quot;
</span><span class='rbrace'>}</span>

<span class='const'>Open3</span><span class='period'>.</span><span class='id popen2'>popen2</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dc</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span><span class='id o'>o</span><span class='comma'>,</span><span class='id t'>t</span><span class='op'>|</span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id print'>print</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>42P</span><span class='tstring_end'>&quot;</span></span>
  <span class='id i'>i</span><span class='period'>.</span><span class='id close'>close</span>
  <span class='id p'>p</span> <span class='id o'>o</span><span class='period'>.</span><span class='id read'>read</span> <span class='comment'>#=&gt; &quot;*&quot;
</span><span class='rbrace'>}</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 134</span>

<span class='kw'>def</span> <span class='id popen2'>popen2</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id in_r'>in_r</span>
  <span class='id in_w'>in_w</span><span class='period'>.</span><span class='id sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id out_w'>out_w</span>

  <span class='id popen_run'>popen_run</span><span class='lparen'>(</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_w'>in_w</span><span class='comma'>,</span> <span class='id out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="popen2e-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>popen2e</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open3.popen2e is similer to Open3.popen3 except it merges the standard
output stream and the standard error stream.</p>

<p>Block form:</p>

<pre class="code">Open3.popen2e([env,] cmd... [, opts]) {|stdin, stdout_and_stderr, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</pre>

<p>Non-block form:</p>

<pre class="code">stdin, stdout_and_stderr, wait_thr = Open3.popen2e([env,] cmd... [, opts])
...
stdin.close  # stdin and stdout_and_stderr should be closed explicitly in this form.
stdout_and_stderr.close</pre>

<p>See Process.spawn for the optional hash arguments <em>env</em> and
<em>opts</em>.</p>

<p>Example:</p>

<pre class="code"># check gcc warnings
source = &quot;foo.c&quot;
Open3.popen2e(&quot;gcc&quot;, &quot;-Wall&quot;, source) {|i,oe,t|
  oe.each {|line|
    if /warning/ =~ line
      ...
    end
  }
}</pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 183</span>

<span class='kw'>def</span> <span class='id popen2e'>popen2e</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id in_r'>in_r</span>
  <span class='id in_w'>in_w</span><span class='period'>.</span><span class='id sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='comma'>,</span> <span class='symbol'>:err</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id out_w'>out_w</span>

  <span class='id popen_run'>popen_run</span><span class='lparen'>(</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_w'>in_w</span><span class='comma'>,</span> <span class='id out_r'>out_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="popen3-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>popen3</strong>(*cmd, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>Open stdin, stdout, and stderr streams and start external executable. In
addition, a thread for waiting the started process is noticed. The thread
has a pid method and thread variable :pid which is the pid of the started
process.</p>

<p>Block form:</p>

<pre class="code">Open3.popen3([env,] cmd... [, opts]) {|stdin, stdout, stderr, wait_thr|
  pid = wait_thr.pid # pid of the started process.
  ...
  exit_status = wait_thr.value # Process::Status object returned.
}</pre>

<p>Non-block form:</p>

<pre class="code">stdin, stdout, stderr, wait_thr = Open3.popen3([env,] cmd... [, opts])
pid = wait_thr[:pid]  # pid of the started process.
...
stdin.close  # stdin, stdout and stderr should be closed explicitly in this form.
stdout.close
stderr.close
exit_status = wait_thr.value  # Process::Status object returned.</pre>

<p>The parameters <tt>cmd...</tt> is passed to Process.spawn. So a commandline
string and list of argument strings can be accepted as follows.</p>

<pre class="code">Open3.popen3(&quot;echo a&quot;) {|i, o, e, t| ... }
Open3.popen3(&quot;echo&quot;, &quot;a&quot;) {|i, o, e, t| ... }
Open3.popen3([&quot;echo&quot;, &quot;argv0&quot;], &quot;a&quot;) {|i, o, e, t| ... }</pre>

<p>If the last parameter, opts, is a Hash, it is recognized as an option for
Process.spawn.</p>

<pre class="code"><span class='const'>Open3</span><span class='period'>.</span><span class='id popen3'>popen3</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>pwd</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:chdir</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id i'>i</span><span class='comma'>,</span><span class='id o'>o</span><span class='comma'>,</span><span class='id e'>e</span><span class='comma'>,</span><span class='id t'>t</span><span class='op'>|</span>
  <span class='id p'>p</span> <span class='id o'>o</span><span class='period'>.</span><span class='id read'>read</span><span class='period'>.</span><span class='id chomp'>chomp</span> <span class='comment'>#=&gt; &quot;/&quot;
</span><span class='rbrace'>}</span></pre>

<p>wait_thr.value waits the termination of the process. The block form also
waits the process when it returns.</p>

<p>Closing stdin, stdout and stderr does not wait the process.</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 73</span>

<span class='kw'>def</span> <span class='id popen3'>popen3</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>Hash</span> <span class='op'>===</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id last'>last</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='id cmd'>cmd</span><span class='period'>.</span><span class='id pop'>pop</span><span class='period'>.</span><span class='id dup'>dup</span>
  <span class='kw'>else</span>
    <span class='id opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id in_w'>in_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:in</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id in_r'>in_r</span>
  <span class='id in_w'>in_w</span><span class='period'>.</span><span class='id sync'>sync</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:out</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id out_w'>out_w</span>

  <span class='id err_r'>err_r</span><span class='comma'>,</span> <span class='id err_w'>err_w</span> <span class='op'>=</span> <span class='const'>IO</span><span class='period'>.</span><span class='id pipe'>pipe</span>
  <span class='id opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:err</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id err_w'>err_w</span>

  <span class='id popen_run'>popen_run</span><span class='lparen'>(</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_r'>in_r</span><span class='comma'>,</span> <span class='id out_w'>out_w</span><span class='comma'>,</span> <span class='id err_w'>err_w</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id in_w'>in_w</span><span class='comma'>,</span> <span class='id out_r'>out_r</span><span class='comma'>,</span> <span class='id err_r'>err_r</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="popen_run-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>popen_run</strong>(cmd, opts, child_io, parent_io) 
  

  
</p><div class="docstring">
  <div class="discussion">
    
<p>:nodoc:</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/open3.rb', line 201</span>

<span class='kw'>def</span> <span class='id popen_run'>popen_run</span><span class='lparen'>(</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='comma'>,</span> <span class='id child_io'>child_io</span><span class='comma'>,</span> <span class='id parent_io'>parent_io</span><span class='rparen'>)</span> <span class='comment'># :nodoc:
</span>  <span class='id pid'>pid</span> <span class='op'>=</span> <span class='id spawn'>spawn</span><span class='lparen'>(</span><span class='op'>*</span><span class='id cmd'>cmd</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='rparen'>)</span>
  <span class='id wait_thr'>wait_thr</span> <span class='op'>=</span> <span class='const'>Process</span><span class='period'>.</span><span class='id detach'>detach</span><span class='lparen'>(</span><span class='id pid'>pid</span><span class='rparen'>)</span>
  <span class='id child_io'>child_io</span><span class='period'>.</span><span class='id each'>each</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id close'>close</span> <span class='rbrace'>}</span>
  <span class='id result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='op'>*</span><span class='id parent_io'>parent_io</span><span class='comma'>,</span> <span class='id wait_thr'>wait_thr</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='kw'>defined?</span> <span class='kw'>yield</span>
    <span class='kw'>begin</span>
      <span class='kw'>return</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='op'>*</span><span class='id result'>result</span><span class='rparen'>)</span>
    <span class='kw'>ensure</span>
      <span class='id parent_io'>parent_io</span><span class='period'>.</span><span class='id each'>each</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id io'>io</span><span class='op'>|</span> <span class='id io'>io</span><span class='period'>.</span><span class='id close'>close</span> <span class='kw'>unless</span> <span class='id io'>io</span><span class='period'>.</span><span class='id closed?'>closed?</span><span class='rbrace'>}</span>
      <span class='id wait_thr'>wait_thr</span><span class='period'>.</span><span class='id join'>join</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Sat Sep  3 14:10:02 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.9.3).
</div>

  </body>
</html>