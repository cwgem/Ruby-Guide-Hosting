<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.5" />
<title>RSpec In Practice</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}
/*
  pygmentize filter
*/
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f4f4f4; }
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */

</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'DIV'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'DIV' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>RSpec In Practice</h1>
<span id="author">@ukstudio (Translator: @cwgem )</span><br />
<span id="revdate">September 28th 2011</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
<a href="#introduction">Introduction</a>
</p>
</li>
<li>
<p>
<a href="#xunit-to-rspec">From xUnit Like Code To RSpec Style</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="#xunit-like-rspec">xUnit like RSpec code</a>
</p>
</li>
<li>
<p>
<a href="#describe-and-context">describe and context</a>
</p>
<div class="ulist"><ul>
<li>
<p>
<a href="#step-by-step-specs">Step by step technical specifications in test code</a>
</p>
</li>
</ul></div>
</li>
<li>
<p>
<a href="#subject">subject</a>
</p>
</li>
<li>
<p>
<a href="#subject-nested-describe">subject and nested describe</a>
</p>
</li>
<li>
<p>
<a href="#it-string-passing">Passing or not passing strings to it</a>
</p>
</li>
<li>
<p>
<a href="#let">Data sharing with let</a>
</p>
</li>
<li>
<p>
<a href="#shared-context">shared_context</a>
</p>
</li>
<li>
<p>
<a href="#related-info">Related Information</a>
</p>
</li>
<li>
<p>
<a href="#conclusion">Conclusion</a>
</p>
</li>
<li>
<p>
<a href="#about-the-author">About The Author</a>
</p>
</li>
<li>
<p>
<a href="#about-translator">About The Translator</a>
</p>
</li>
</ul></div>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This document is a translation of a Japanese article by ukstudio on the topic of writing RSpec tests. It was published in <a href="http://jp.rubyist.net/magazine/?0035-RSpecInPractice">Rubyist Magazine Volume 35</a>.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>This article is meant to serve as an exploration of the RSpec testing framework. It is not intended to be an introduction, but rather aimed at presenting its practical uses. At minimum the reader should be familiar with <tt>it</tt>, <tt>describe</tt>, and testing fundamentals in general.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">I&#8217;ve left out the translation of the second paragraph as it targets Japan users specifically and does not make sense to have in the context of a translation targeted towards English-speaking users.</td>
</tr></table>
</div>
<div class="paragraph"><p>This article hopes to improve on the availability of RSpec documentation by exploring RSpec usage for those interested, or those who wish to improve master of it.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="xunit-to-rspec">From xUnit Like Code To RSpec Style</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="xunit-like-rspec">xUnit like RSpec code</h3>
<div class="paragraph"><p>"xUnit like code" is essentially code that does not properly utilize RSpec features, and treats <tt>it</tt> the same as xUnit test methods.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@stack</span> <span class="o">=</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;the return value of #push should equal the pushed value&#39;</span> <span class="k">do</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value&#39;</span>
  <span class="k">end</span>
  <span class="n">it</span> <span class="s1">&#39;when the stack is empty, #pop should return nil&#39;</span> <span class="k">do</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;When the stack contains values, #pop returns the last value&#39;</span> <span class="k">do</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value2&#39;</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value2&#39;</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value1&#39;</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">&#39;#size returns the size of the stack&#39;</span> <span class="k">do</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">0</span>

    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value&#39;</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The above test code is written using RSpec to test stack construction through the <tt>Stack</tt> class. <tt>Stack</tt> has 3 methods, <tt>push</tt>, <tt>pop</tt>, and <tt>size</tt>.</p></div>
<div class="paragraph"><p>xUnit generally has test methods defined in a more flat manner (though this style has been changing as of late), so one could consider this code to be "xUnit like". The test method is simply rewritten to use <tt>it</tt> instead, and the <tt>before</tt> block is used like a <tt>setup</tt> method.</p></div>
</div>
<div class="sect2">
<h3 id="describe-and-context">describe and context</h3>
<div class="paragraph"><p>We&#8217;ll take this code and make a few adjustments to it. First off will be the usage of <tt>describe</tt>. While there should always be at least one <tt>describe</tt> present, it is possible to have multiple declarations at the same level, or even nested.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@stack</span> <span class="o">=</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#push&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;returns the pushed value&#39;</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;throws an exception if nil is pushed&#39;</span> <span class="k">do</span>
      <span class="nb">lambda</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">should</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;when the stack is empty, #pop will return nil&#39;</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;when the stack contains values, #pop will return the last value&#39;</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value2&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value2&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value1&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#size&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;#size returns the size of the stack&#39;</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">0</span>

      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Using <tt>describe</tt> helps to establish structure in the test code. Because each and every test case is grouped, it makes it easier to understand what the functionality is being tested.</p></div>
<div class="paragraph"><p>Next is the usage of <tt>context</tt>. <tt>context</tt> is just an alias for <tt>describe</tt>, but it serves a different purpose. To put it simply, <tt>describe</tt> is meant to indicate what is being tested, while <tt>context</tt> is meant to describe the state of the test when it is run.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@stack</span> <span class="o">=</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
  <span class="n">describe</span> <span class="s1">&#39;#push&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;normal value&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;returns the pushed value&#39;</span> <span class="k">do</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">&#39;nil is pushed&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;throws an exception&#39;</span> <span class="k">do</span>
        <span class="nb">lambda</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="kp">nil</span><span class="p">)</span> <span class="p">}</span><span class="o">.</span><span class="n">should</span> <span class="n">raise_error</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;the stack is empty&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;nil is returned&#39;</span> <span class="k">do</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">be_nil</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">&#39;the stack contains values&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;the last value is returned&#39;</span> <span class="k">do</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value2&#39;</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value2&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#size&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;returns the size of the stack&#39;</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">0</span>

      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>In this case, <tt>describe</tt> is used to categorize tests by individual methods. The reason for this being that test cases are generally written to target specific methods, so this separation helps improve test code organization. It also has the added benefit of being easier to read.</p></div>
<div class="paragraph"><p>However, there are times when the target of the tests are not methods alone. Often times communication between several objects is being tested. In this case the user should use <tt>describe</tt> in a manner that is easiest for them to understand given the situation. One mustn&#8217;t take too much time fussing over method separation.</p></div>
<div class="sect3">
<h4 id="step-by-step-specs">Step by step technical specifications in test code</h4>
<div class="paragraph"><p>I personally believe that the general concept behind <tt>describe</tt> and <tt>context</tt> is extremely important. This is because it has the capability to be used as a tool to lay out technical specifications through test code.</p></div>
<div class="paragraph"><p>For example, when writing test code for the <tt>Stack</tt> class, the general thought process would start with the implementation of methods. First is the push method implementation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">&#39;#push&#39;</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Now that there is a method to work with, the next step is thinking about how to call the method. In the case of <tt>push</tt>, the first case is the storage of the value passed in. First the test case is written using <tt>it</tt>, disregarding for now any other <tt>context</tt>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">&#39;#push&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;stores the value&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>When considering proper values to pass in, it is also important to consider improper values. For example, when <tt>nil</tt> is passed in an exception is thrown. Since this situation is different from that of a proper value, <tt>context</tt> must be utilized:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">&#39;#push&#39;</span> <span class="k">do</span>
    <span class="n">context</span> <span class="s1">&#39;proper value&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;stores the value&#39;</span>
    <span class="k">end</span>

    <span class="n">context</span> <span class="s1">&#39;nil value&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="s1">&#39;throws an exception&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>In this way <tt>describe</tt>, <tt>context</tt>, and <tt>it</tt> are utilized in sequential order to provide step by step test code which presents technical specifications. The usage of <tt>describe</tt> and <tt>context</tt> to organize application specification helps ease the design process.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="subject">subject</h3>
<div class="paragraph"><p>In RSpec when <tt>subject</tt> is used the receiver of <tt>should</tt> can be omitted. Rewriting the previous code to use <tt>subject</tt> gives:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">&#39;the stack is empty&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s1">&#39;returns nil&#39;</span> <span class="k">do</span>
      <span class="n">should</span> <span class="n">be_nil</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">&#39;the stack contains values&#39;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
      <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value2&#39;</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">&#39;returns the last value&#39;</span> <span class="k">do</span>
      <span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value2&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The merit of <tt>subject</tt> is that it clearly indicates the target of the test, and it requires that a single test case can only contain a single assertion. When writing a test, it puts importance on the awareness about what is currently being tested. While <tt>describe</tt> tends to be very clear in intentions, <tt>subject</tt> is a bit weak in comparison. The usage <tt>subject</tt> is splitting out often generally vague sections, such as whether the state of an object after method invocation, or the return of a method is being tested.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="nb">Array</span><span class="p">,</span> <span class="s1">&#39;#delete&#39;</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">].</span><span class="n">delete</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="mi">3</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="nb">Array</span><span class="p">,</span> <span class="s1">&#39;#delete&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@array</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">]</span>
    <span class="vi">@array</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@array</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="ss">:size</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="mi">2</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>As shown in the code, the usage of <tt>subject</tt> makes it so there is only one assertion per test case. In general it&#8217;s a good idea to write tests this way, and using <tt>subject</tt> makes it more natural to write them as such.</p></div>
</div>
<div class="sect2">
<h3 id="subject-nested-describe">subject and nested describe</h3>
<div class="paragraph"><p>There are cases in which test code will need to operate on a related object that was previously tested. For example, a <tt>User</tt> class with a related <tt>Profile</tt> class. In this case, if <tt>subject</tt> is used to omit the receiver of <tt>should</tt>, it won&#8217;t be possible to access the related object. To resolve this issue a nested <tt>describe</tt> can be used with another <tt>subject</tt> declaration.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#create!&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{</span> <span class="vi">@user</span><span class="o">=</span><span class="no">User</span><span class="o">.</span><span class="n">create!</span> <span class="p">}</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_new_record</span> <span class="p">}</span>

  <span class="n">describe</span> <span class="no">Profile</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span><span class="o">.</span><span class="n">profile</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_new_record</span> <span class="p">}</span>
    <span class="n">its</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;AKAMATSU Yuki&#39;</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Using this method it is possible to test the related object from a previous test. This situation is fairly common for those developing Rails applications.</p></div>
<div class="paragraph"><p>Another solution is to use <tt>its</tt>, which is useful when there are few areas which require testing.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#create!&#39;</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">User</span><span class="o">.</span><span class="n">create!</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_new_record</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="ss">:profile</span><span class="p">)</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_new_record</span> <span class="p">}</span>
  <span class="n">its</span><span class="p">(</span><span class="s1">&#39;profile.name&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;AKAMATSU Yuki&#39;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="it-string-passing">Passing or not passing strings to it</h3>
<div class="paragraph"><p>Now then, some of you may have already noticed that the style of how the tests were written changed throughout the article. For instance, <tt>it</tt> can have the string passed to it omitted. When used this way RSpec code such as "it should be nil" can be read like a normal English sentence.</p></div>
<div class="paragraph"><p>A common debate regarding RSpec usage is whether or not to pass a string to <tt>it</tt>. I notice that users who tend to constantly use the most up to date versions of RSpec often lean towards leaving out the string. I agree with this sediment and would rather let the RSpec code speak for itself.</p></div>
<div class="paragraph"><p>The reason for this is that passing a string to <tt>it</tt> has a similar problem to lacking separation between code and comments. One of the recent trends in writing good code is the principle of "writing code that can be understood without relying on comments." The logic is that when dealing with code and comments, just modifying one leaves the other inconsistent, violating the principle of DRY (Don&#8217;t Repeat Yourself).</p></div>
<div class="paragraph"><p>The same can be said about RSpec&#8217;s <tt>it</tt> and passing a string to it. Situations where the string passed to <tt>it</tt> being left as is while the test code is modified happens quite often. Also by constantly passing strings to <tt>it</tt>, the test code becomes much longer.</p></div>
<div class="paragraph"><p>However, that is not to say that leaving the string out is without problems. For instance, the documentation produced by RSpec&#8217;s &#8216;--format documentation` can become more difficult to read. As an example, in the code from the <tt>Stack</tt> class the "returns the last value" code becomes "should eq 'value1&#8217;". This makes it impossible to discern what is being tested.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Stack
   #pop
     the stack is empty
       returns nil
     the stack contains values
       returns the last value
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Stack
   #pop
     the stack is empty
       should be nil
     the stack contains values
       should == value2
</pre></div></div></div>
<div class="paragraph"><p>There are a few ways to solve this. One of them is to explicitly indicate the value using <tt>context</tt>. The other is to define a custom matcher.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span><span class="o">.</span><span class="n">define</span> <span class="ss">:be_latest_value</span> <span class="k">do</span> <span class="o">|</span><span class="n">expected</span><span class="o">|</span>
  <span class="n">match</span> <span class="k">do</span> <span class="o">|</span><span class="n">actual</span><span class="o">|</span>
    <span class="n">actual</span> <span class="o">==</span> <span class="n">latest_value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{</span> <span class="vi">@stack</span> <span class="o">=</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
  <span class="n">describe</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span> <span class="p">}</span>

    <span class="n">context</span> <span class="s1">&#39;the stack is empty&#39;</span> <span class="k">do</span>
      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_nil</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="c1"># Explicitly indicate the value with context</span>
    <span class="n">context</span> <span class="s1">&#39;the last value of the stack is &quot;value2&quot;&#39;</span> <span class="k">do</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value2&#39;</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;value2&#39;</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="c1"># Adjust the meaning with a custom matcher</span>
    <span class="n">context</span> <span class="s1">&#39;The stack contains values&#39;</span> <span class="k">do</span>
      <span class="n">let</span><span class="p">(</span><span class="ss">:latest_value</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;value2&#39;</span> <span class="p">}</span>
      <span class="n">before</span> <span class="k">do</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
        <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="n">latest_value</span>
      <span class="k">end</span>

      <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_latest_value</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>Stack
   #pop
     the stack is empty
       should be nil
     the last value of the stack is &quot;value2&quot;
       should == value2
     the stack contains values
       should be latest value
</pre></div></div></div>
<div class="paragraph"><p>By using <tt>context</tt> to explicitly declare the value, it is easier to discern that RSpec&#8217;s output means the last value will be returned. Using a customer matcher, the code will be output as is and is even easier to read.</p></div>
<div class="paragraph"><p>However, I personally don&#8217;t take it this far. At most I would worry about the wording of <tt>context</tt><a id="ftm01"></a><a href="#ftm01-end"><sub>*1</sub></a>. The reason being that as a programmer, reading the test code is more important than reading the documentation. With this in mind it would seem unreasonable to just read the RSpec output alone. This is why I&#8217;m less concerned about sentences in the output looking odd as long as the test code is easy to read.</p></div>
<div class="paragraph"><p>In conclusion, I recommend using <tt>it</tt> without passing in a string. The strongest reason for this being that mixing strings and test code violates the DRY principle. Also the samples given here are small so the issue with size is not as apparent. However it&#8217;s normal for test cases to be much more numerous. In these cases leaving out the string results in more compact test code.</p></div>
<div class="paragraph"><p>While I recommend omitting the string, there are those who feel it is more natural to take the opposite approach<a id="ftm02"></a><a href="#ftm02-end"><sub>*2</sub></a>. You should use your best judgement, and what is most comfortable to decide which method you agree with. Both have advantages and disadvantages, do there is no strictly correct answer.</p></div>
</div>
<div class="sect2">
<h3 id="let">Data sharing with let</h3>
<div class="paragraph"><p>In RSpec there is a function known as <tt>let</tt>. Compared to <tt>subject</tt> and other features, the usage is hard to grasp for a lot of users, so I&#8217;ll attempt to explain its usage.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="s1">&#39;let&#39;</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;foo&#39;</span> <span class="p">}</span>
  <span class="n">specify</span> <span class="p">{</span> <span class="n">foo</span><span class="o">.</span><span class="n">should</span> <span class="n">eq</span> <span class="s1">&#39;foo&#39;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p><tt>let</tt> takes the evaluation result of the block passed in, then stores the result in a variable of the same name as the symbol given in the argument. In the above example, the evaluation result of the block is "foo" and the symbol name is <tt>:foo</tt>, so "foo" will be stored in a variable named <tt>foo</tt>. This method utilizes lazy evaluation<a id="ftm03"></a><a href="#ftm03-end"><sub>*3</sub></a>, so the block won&#8217;t be evaluated unless explicitly called. Results of the block evaluation will be cached and accessible within the same test case, ensuring that multiple calls will not produce multiple evaluations of the block.</p></div>
<div class="paragraph"><p>When writing tests, there are often cases where the methods being called are the same, but data is slightly different. Previously this was addressed through writing out the same processing code using <tt>before</tt> inside of <tt>describe</tt> and <tt>context</tt>. Now that there&#8217;s <tt>let</tt>, we can be a little smarter about how the code is written.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#admin?&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">&#39;admin&#39;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="no">Role</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:role</span> <span class="o">=&gt;</span> <span class="ss">:admin</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_admin</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">&#39;not admin&#39;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="k">do</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="no">Role</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:role</span> <span class="o">=&gt;</span> <span class="ss">:normal</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_admin</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The <tt>User</tt> class contains a <tt>Role</tt> class, and the return value of the <tt>admin?</tt> method changes depending on the state of the <tt>Role</tt>. This code was written without the use of <tt>let</tt>, instead utilizing <tt>before</tt> and <tt>subject</tt>. The <tt>context</tt> of <tt>admin</tt> and <tt>not admin</tt> differ solely in the arguments passed to the <tt>Role</tt> class constructor.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#admin?&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="no">Role</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:role</span> <span class="o">=&gt;</span> <span class="n">role</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="vi">@user</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">&#39;admin&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:role</span><span class="p">)</span> <span class="p">{</span> <span class="ss">:admin</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_admin</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">&#39;not admin&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:role</span><span class="p">)</span> <span class="p">{</span> <span class="ss">:normal</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should_not</span> <span class="n">be_admin</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Since <tt>let</tt> in this manner allows for separation of data, <tt>Role</tt> initialization of can be moved to a single <tt>before</tt>. Compared to the previous code, this version adheres more closely to the DRY principle. It can be considered a more orthodox approach to using <tt>let</tt>.</p></div>
<div class="paragraph"><p>Of course, <tt>let</tt> can also be used as a simple replacement of instance variables. While this is somewhat a matter of preference, the definition of data can be written more declaratively, making the test code easier to read.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="no">Stack</span><span class="p">,</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:stack</span><span class="p">)</span> <span class="p">{</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span> <span class="p">}</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span> <span class="p">}</span>

  <span class="n">context</span> <span class="s1">&#39;the stack is empty&#39;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_nil</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">&#39;the stack contains values&#39;</span> <span class="k">do</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:oldest_value</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;value1&#39;</span> <span class="p">}</span>
    <span class="n">let</span><span class="p">(</span><span class="ss">:latest_value</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;value2&#39;</span> <span class="p">}</span>

    <span class="n">before</span> <span class="k">do</span>
      <span class="n">stack</span><span class="o">.</span><span class="n">push</span> <span class="n">oldest_value</span>
      <span class="n">stack</span><span class="o">.</span><span class="n">push</span> <span class="n">latest_value</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="n">latest_value</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="shared-context">shared_context</h3>
<div class="paragraph"><p>As mentioned before, RSpec&#8217;s <tt>context</tt> is used to separate out the state of the test case. However as <tt>context</tt> is simply an alias of <tt>describe</tt>, it doesn&#8217;t really do anything by itself. In order to actually implement the context, it is necessary to use <tt>before</tt> and <tt>subject</tt>.</p></div>
<div class="paragraph"><p>There are often times when the same context cannot be combined into a single <tt>context</tt> block. For example, when the tests for several methods utilize the same context.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">describe</span> <span class="s1">&#39;#method_a&#39;</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;#context_a&#39;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{}</span> <span class="c1"># Not DRY</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s1">&#39;#method_b&#39;</span> <span class="k">do</span>
  <span class="n">context</span> <span class="s1">&#39;#context_a&#39;</span> <span class="k">do</span>
    <span class="n">before</span> <span class="p">{}</span> <span class="c1"># Not DRY</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>While it is possible to reverse the nesting of <tt>context</tt> and <tt>describe</tt>, testing of methods often entails running them under different contexts, meaning the methods will be dispersed all over the code.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">context</span> <span class="s1">&#39;#context_a&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{}</span>

  <span class="n">describe</span> <span class="s1">&#39;#method_a&#39;</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#method_b&#39;</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">context</span> <span class="s1">&#39;#context_b&#39;</span> <span class="k">do</span>
  <span class="n">before</span> <span class="p">{}</span>

  <span class="n">describe</span> <span class="s1">&#39;#method_a&#39;</span> <span class="k">do</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#method_b&#39;</span> <span class="k">do</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>Even though the methods are scattered about, it still appears to be reasonably well organized. However there is a big problem with this. As mentioned before, specifications should be noted in step by step test code. In order to achieve this, writing of test code starts with writing out separate <tt>describe</tt> blocks. However writing tests using nested <tt>context</tt> blocks as shown means that the context of the test will come before the description of what is being tested, which is not very natural. For this reason I do not recommend this style.</p></div>
<div class="paragraph"><p><tt>shared_context</tt> can be used to solve this issue. As the name states <tt>shared_context</tt> shares the context (state at the time of running the test) between different tests.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">shared_context</span> <span class="s1">&#39;two items are pushed&#39;</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:latest_value</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;value2&#39;</span> <span class="p">}</span>
  <span class="n">before</span> <span class="k">do</span>
    <span class="vi">@stack</span> <span class="o">=</span> <span class="no">Stack</span><span class="o">.</span><span class="n">new</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="s1">&#39;value1&#39;</span>
    <span class="vi">@stack</span><span class="o">.</span><span class="n">push</span> <span class="n">latest_value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="no">Stack</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s1">&#39;#size&#39;</span> <span class="k">do</span>
    <span class="n">include_context</span> <span class="s1">&#39;two items are pushed&#39;</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">size</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="mi">2</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s1">&#39;#pop&#39;</span> <span class="k">do</span>
    <span class="n">include_context</span> <span class="s1">&#39;two items are pushed&#39;</span>
    <span class="n">subject</span> <span class="p">{</span> <span class="vi">@stack</span><span class="o">.</span><span class="n">pop</span> <span class="p">}</span>
    <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">eq</span> <span class="n">latest_value</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div>
<div class="paragraph"><p>By using <tt>shared_context</tt> in this manner, shared functionality can be consolidated into a single area. It&#8217;s also possible to define <tt>shared_context</tt> in another file and <tt>require</tt> it in the appropriate locations.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="related-info">Related Information</h2>
<div class="sectionbody">
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">I&#8217;ve left out translation of some content here as it targets Japanese speakers</td>
</tr></table>
</div>
<div class="paragraph"><p>When using RSpec, an issue that often crops up is wanting to know more about how functionality works, but the user is unsure about where to start. At times like these the documentation is the best resource. <a href="http://www.rspec.info">rspec.info</a> is not that frequently updated, so I recommend using Relish&#8217;s <a href="http://www.relishapp.com/rspec">RSpec Documentation</a> instead.</p></div>
<div class="paragraph"><p>Relish uses Cucumber scenarios as a documentation format. With this in mind it can be considered the latest documentation. However the Relish documentation is very API like in style, so even if you understand the usage you may not know how to put it to practical use. When I first started with RSpec I wasn&#8217;t sure about how <tt>let</tt> worked so I added it into my usual test writing habits until it finally stuck.</p></div>
<div class="paragraph"><p>These types of problems are more difficult, so the best solution is to Google around or ask someone. Of course there&#8217;s always figuring it out on your own. If you find it necessary to ask someone for help, asking around in places like <a href="http://www.twitter.com">Twitter</a> is likely to get an answer.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph"><p>I&#8217;ve often heard of RSpec being referred to as difficult or complaints about the syntax being too complicated. The reason for this seems to me that Rubyists are used to thinking in terms of Ruby code, and that there is a gap between that and RSpec DSL. Honestly I believe this comes down to getting accustomed to it. There will always be those who simply cannot grasp how the system works.</p></div>
<div class="paragraph"><p>For those cases I recommend starting from <tt>describe</tt> and <tt>context</tt>. Being able to utilize them in order to test specifications is sufficient enough in my opinion. Even writing <tt>Test::Unit</tt> like cases inside of <tt>it</tt> statements would be good practice.</p></div>
<div class="paragraph"><p>As you progress I believe you will start to feel a need to make test code more DRY compliant. At this point it would be a good idea to start using <tt>subject</tt>, <tt>let</tt>, and <tt>shared_context</tt> to achieve this goal. RSpec is an extremely powerful framework when it comes to writing DRY test code. While RSpec may seem complicated with all the features, taking things in small steps should help in comprehending what&#8217;s happening.</p></div>
<div class="paragraph"><p>The knowledge presented here does not encompass everything I know. There&#8217;s a lot of other information I&#8217;d like to present, but that would take an entire book to cover so I hope you don&#8217;t mind me leaving it out. I hope that this article provides a useful reference for those wanting to improve their RSpec mastery.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="about-the-author">About The Author</h2>
<div class="sectionbody">
<div class="paragraph"><p>Akamatsu Yuki (<a href="http://twitter.com/ukstudio">@ukstudio</a>)</p></div>
<div class="paragraph"><p>Freelance Ruby programmer. Most recent work is development for <a href="http://scaleout.jp/">ScaleOut</a>. Currently in the process of writing an introductory book to TDD in Ruby. If all goes well it will be available sometime next year. Please buy it when it comes out.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="about-translator">About The Translator</h2>
<div class="sectionbody">
<div class="paragraph"><p>Hello I&#8217;m Chris White (<a href="http://www.twitter.com/cwgem">@cwgem</a>), a passionate Rubyist. I&#8217;ve been studying Japanese for many years, and enjoy doing technical translations. As test driven development is very important within the Ruby community, I felt translation of this article would benefit the community as a whole. @ukstudio&#8217;s article was incredibly insightful and am glad to have translated it! I hope you enjoyed it as much as I did!</p></div>
<div class="paragraph"><p><a id="ftm01-end"></a><a href="#ftm01">*1</a> I like the usage of custom matchers, but in this use case the definitions would increase too much so I avoid it in this situation<br />
<a id="ftm02-end"></a><a href="#ftm02">*2</a> Jared Carroll for example <a href="http://blog.carbonfive.com/2010/10/21/rspec-best-practices/">RSpec best practices</a><br />
<a id="ftm03-end"></a><a href="#ftm03">*3</a> Edit: there is also a non-lazy version called <tt>let!</tt><br /></p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2011-09-30 12:11:15 PDT
</div>
</div>
</body>
</html>
